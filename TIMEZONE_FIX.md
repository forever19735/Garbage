# 時區問題修正說明

## 🎯 問題描述

之前當使用 `@setcron mon 2 19` 指令時，實際推播時間會變成上午 10:19，而不是預期的凌晨 2:19。這是因為 `CronTrigger` 沒有明確指定時區，導致時區轉換問題。

## ✅ 解決方案

已經修正所有排程設定指令，確保它們都明確指定 `Asia/Taipei` 時區：

### 修正的指令

1. **`@setcron`** - 同時設定星期和時間
2. **`@setday`** - 設定推播星期
3. **`@settime`** - 設定推播時間
4. **`update_schedule()` 函數** - 程式內部更新排程
5. **初始排程設定** - 預設排程

### 修正前後對比

#### 修正前：
```python
job = scheduler.add_job(send_trash_reminder, CronTrigger(day_of_week=days, hour=hour, minute=minute))
```

#### 修正後：
```python
job = scheduler.add_job(
    send_trash_reminder, 
    CronTrigger(
        day_of_week=days, 
        hour=hour, 
        minute=minute,
        timezone=pytz.timezone('Asia/Taipei')  # 明確指定時區
    )
)
```

## 🧪 測試結果

### 測試案例 1: 凌晨時間
- **輸入**: `@setcron mon 2 19`
- **預期**: 週一凌晨 2:19 (台北時間)
- **實際**: 2025-11-03 02:19:00 CST ✅

### 測試案例 2: 下午時間
- **輸入**: `@setcron mon 14 19`
- **預期**: 週一下午 2:19 (台北時間)
- **實際**: 2025-10-27 14:19:00 CST ✅

## 🔧 其他改進

### 1. 增強的錯誤驗證
- 小時範圍檢查 (0-23)
- 分鐘範圍檢查 (0-59)
- 友善的錯誤訊息

### 2. 更詳細的回覆訊息
```
✅ 推播時間已更新為 mon 02:19 (台北時間)
⏰ 下次執行: 2025-11-03 02:19:00 CST
```

### 3. 智能時間保持
- `@setday` 會保持目前的時間設定
- `@settime` 會保持目前的星期設定

## 📋 使用指南

### 基本指令格式
```
@setcron mon 2 19      # 週一凌晨 2:19
@setcron tue,fri 18 30 # 週二、週五晚上 6:30
@settime 14:30         # 改為下午 2:30
@setday sat,sun        # 改為週六、週日
```

### 時間格式說明
- **24 小時制**: 0-23 (0=午夜, 12=中午, 18=下午6點)
- **分鐘**: 0-59
- **星期**: mon, tue, wed, thu, fri, sat, sun

### 確認設定
使用 `@schedule` 指令查看當前排程：
```
📅 垃圾收集提醒排程
🕐 執行時間: 02:19 (Asia/Taipei)
📆 執行星期: 週一
⏰ 下次執行: 2025-11-03 02:19:00 CST
⏳ 距離下次: 6 天 15 小時 51 分鐘
✅ 排程狀態: 已啟動
```

## ⚠️ 重要提醒

1. **時區一致性**: 所有時間都是台北時間 (UTC+8)
2. **CST 顯示**: CST = 中原標準時間 = 台北時間
3. **即時生效**: 設定後立即更新排程
4. **持久性**: 程式重啟後會回到預設設定 (週一、週四 17:10)

## 🎉 結論

現在當你輸入 `@setcron mon 2 19` 時，系統會正確設定為**週一凌晨 2:19 (台北時間)**，不會再有時區轉換問題！
